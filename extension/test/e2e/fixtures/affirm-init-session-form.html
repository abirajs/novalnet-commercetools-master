<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Create Session for Affirm Payment</title>

    <link
      rel="stylesheet"
      href="https://checkoutshopper-live.novalnet.com/checkoutshopper/sdk/5.53.2/novalnet.css"
      integrity="sha384-9EdBqZRrjozkt+Be5ycjHBTi+4DYrafpC1KyPnNyTBfjBIZ5+oMp8BbgvPLGgsE0"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div>
      <input
        type="text"
        id="novalnet-client-key"
        placeholder="novalnet client key"
      /><br />
      <input
        type="text"
        id="novalnet-session-id"
        placeholder="novalnet session ID"
      /><br />
      <textarea
        id="novalnet-session-data"
        placeholder="novalnet session data"
      ></textarea
      ><br />

      <textarea id="novalnet-payment-form-input"> </textarea>
      <br />
      <input type="text" class="firstname secondname" />
    </div>
    <br />
    <div id="affirm-container"></div>

    <script
      src="https://checkoutshopper-live.novalnet.com/checkoutshopper/sdk/5.53.2/novalnet.js"
      integrity="sha384-ng3HLoZIlQ3BLgyGyGNiwWSx6LEPIlmxVuGRw72skZFt9mL8OweRjp7vcPzSqxTj"
      crossorigin="anonymous"
    ></script>
    <script type="application/javascript">
      const configuration = {
        environment: 'test', // When you"re ready to accept live payments, change the value to one of our live environments https://docs.novalnet.com/checkout/components-web#testing-your-integration.
        clientKey: '', // Your client key. To find out how to generate one, see https://docs.novalnet.com/development-resources/client-side-authentication.
        session: {
          id: '',
          sessionData: '',
        },

        onPaymentCompleted: (result, component) => {
          console.info(result, component)
          document.getElementById('novalnet-payment-auth-result').innerHTML =
            JSON.stringify(result)
        },
        onError: (error, component) => {
          console.error(error.name, error.message, error.stack, component)
          document.getElementById('novalnet-payment-auth-result').innerHTML =
            JSON.stringify(error)
        },
        showPayButton: true,
        countryCode: 'US', // the country code from the
      }
      async function renderAffirmWebComponent() {
        const clientKeyElement = document.getElementById('novalnet-client-key')
        configuration.clientKey = clientKeyElement.value
        configuration.session.id =
          document.getElementById('novalnet-session-id').value
        configuration.session.sessionData =
          document.getElementById('novalnet-session-data').value
        const checkout = await novalnetCheckout(configuration)
        checkout.create('affirm').mount('#affirm-container')
      }
      function buildCreateSessionFormInput() {
        const createSessionFormInput = {}

        createSessionFormInput.shopperEmail = 'test@test.com'
        createSessionFormInput.telephoneNumber = '+31612345678'

        createSessionFormInput.shopperName = {
          firstName: 'firstName',
          lastName: 'lastName',
        }

        createSessionFormInput.billingAddress = {
          city: 'San Francisco',
          country: 'US',
          houseNumberOrName: '274',
          postalCode: '94107',
          street: 'Brannan St.',
          stateCode: 'CA',
        }
        document.getElementById('novalnet-payment-form-input').innerText =
          JSON.stringify(createSessionFormInput)
      }

      const sessionDataElement = document.getElementById('novalnet-session-data')
      sessionDataElement.addEventListener('blur', () => {
        renderAffirmWebComponent()
      })

      buildCreateSessionFormInput()
    </script>
  </body>
</html>
