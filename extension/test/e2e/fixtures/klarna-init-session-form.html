<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Klarna initialize payment session</title>
    <link
      rel="stylesheet"
      href="https://checkoutshopper-live.novalnet.com/checkoutshopper/sdk/5.53.2/novalnet.css"
      integrity="sha384-9EdBqZRrjozkt+Be5ycjHBTi+4DYrafpC1KyPnNyTBfjBIZ5+oMp8BbgvPLGgsE0"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div>
      <input
        type="text"
        id="novalnet-client-key"
        placeholder="novalnet client key"
      /><br />
      <input
        type="text"
        id="novalnet-session-id"
        placeholder="novalnet session ID"
      /><br />
      <textarea
        id="novalnet-session-data"
        placeholder="novalnet session data"
      ></textarea
      ><br />

      <textarea id="novalnet-payment-form-input"> </textarea>
      <br />
    </div>
    <br />
    <div id="klarna_paynow-container"></div>

    <script
      src="https://checkoutshopper-live.novalnet.com/checkoutshopper/sdk/5.53.2/novalnet.js"
      integrity="sha384-ng3HLoZIlQ3BLgyGyGNiwWSx6LEPIlmxVuGRw72skZFt9mL8OweRjp7vcPzSqxTj"
      crossorigin="anonymous"
    ></script>
    <script type="application/javascript">
      async function renderKlarnaWebComponent() {
        const clientKeyElement = document.getElementById('novalnet-client-key')
        configuration.clientKey = clientKeyElement.value
        configuration.session.id =
          document.getElementById('novalnet-session-id').value
        configuration.session.sessionData =
          document.getElementById('novalnet-session-data').value
        const checkout = await novalnetCheckout(configuration)
        checkout.create('klarna_paynow').mount('#klarna_paynow-container')
      }
      const configuration = {
        environment: 'test', // When you"re ready to accept live payments, change the value to one of our live environments https://docs.novalnet.com/checkout/components-web#testing-your-integration.
        clientKey: '', // Your client key. To find out how to generate one, see https://docs.novalnet.com/development-resources/client-side-authentication.
        session: {
          id: '',
          sessionData: '',
        },
        countryCode: 'DE',
        shopperLocale: 'de-DE',
        shopperReference: 'YOUR TEST REFERENCE',
        shopperEmail: 'customer@email.de',
        billingAddress: {
          city: 'München',
          country: 'DE',
          houseNumberOrName: '44',
          postalCode: '80797',
          street: 'Adams-Lehmann-Straße',
        },
        shopperName: {
          firstName: 'firstName',
          gender: 'MALE',
          lastName: 'lastName',
        },
        lineItems: [
          {
            quantity: '1',
            amountExcludingTax: '331',
            taxPercentage: '2100',
            description: 'Shoes',
            id: 'Item #1',
            taxAmount: '69',
            amountIncludingTax: '400',
          },
          {
            quantity: '2',
            amountExcludingTax: '248',
            taxPercentage: '2100',
            description: 'Socks',
            id: 'Item #2',
            taxAmount: '52',
            amountIncludingTax: '300',
          },
        ],

        onPaymentCompleted: (result, component) => {
          console.info(result, component)
          document.getElementById('novalnet-payment-auth-result').innerHTML =
            JSON.stringify(result)
        },
        onError: (error, component) => {
          console.error(error.name, error.message, error.stack, component)
          document.getElementById('novalnet-payment-auth-result').innerHTML =
            JSON.stringify(error)
        },
        showPayButton: true,
      }
      const sessionDataElement = document.getElementById('novalnet-session-data')
      sessionDataElement.addEventListener('blur', () => {
        renderKlarnaWebComponent()
      })
    </script>
  </body>
</html>
